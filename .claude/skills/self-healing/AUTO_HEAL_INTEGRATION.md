# Auto-Heal Integration

## Purpose

This document defines the automatic self-healing integration that ensures ALL new skills are self-healing by default.

---

## Detection Rules

### When Creating ANY New Skill

The agent MUST check:

1. **Does the skill have a SELF_HEALING.md file?**
   - If NO ‚Üí Trigger auto-heal prompt

2. **Does the skill have a `/{skill}-feedback` command?**
   - If NO ‚Üí Trigger auto-heal prompt

3. **Is the skill registered in a SELF_HEALING.md somewhere?**
   - If NO ‚Üí Trigger auto-heal prompt

---

## Auto-Heal Prompt Flow

When a skill is detected without self-healing:

```
üîß SELF-HEALING NOT DETECTED

This skill doesn't have self-healing enabled yet.
Self-healing helps the skill improve over time based on your feedback.

Would you like me to add self-healing to this skill?

[Yes - Add self-healing] [No - Skip for now]
```

If user says YES:

```
Great! Let me customize the self-healing for your skill.

I'll analyze your skill to identify:
- What outputs it produces
- What could go wrong
- What feedback categories make sense

One moment...
```

---

## Auto-Generate Custom SELF_HEALING.md

### Step 1: Analyze the Skill

Read the skill's files and extract:
- **Purpose**: What does this skill do?
- **Outputs**: What does it produce? (copy, code, analysis, etc.)
- **Quality Markers**: What makes output "good"?
- **Common Failures**: What typically goes wrong?

### Step 2: Generate Custom Categories

Based on analysis, create skill-specific categories:

```markdown
## Healing Categories for {skill-name}

| Category | What to Watch For |
|----------|-------------------|
| {Custom 1} | {Specific to this skill} |
| {Custom 2} | {Specific to this skill} |
| Output Quality | General quality issues |
| False Positives | Over-corrections |
```

### Step 3: Generate Custom Review Checklist

Create a checklist specific to this skill's outputs:

```markdown
## Review Checklist

Before approving output from this skill, check:

- [ ] {Skill-specific check 1}
- [ ] {Skill-specific check 2}
- [ ] {Skill-specific check 3}
- [ ] Meets quality baseline
- [ ] No obvious errors
```

### Step 4: Generate Approval Criteria

Define what "good enough" means for this skill:

```markdown
## Approval Criteria

### Auto-Approve If:
- {Condition 1}
- {Condition 2}

### Request Review If:
- {Condition 1}
- {Condition 2}

### Block If:
- {Critical issue 1}
- {Critical issue 2}
```

---

## Template for Auto-Generated SELF_HEALING.md

```markdown
# {Skill Name} - Self-Healing Log

This file captures VALUE LESSONS from feedback to improve {skill-name}.

---

## About This Skill

**Purpose:** {auto-detected purpose}
**Main Output:** {what it produces}
**Quality Goal:** {what "good" looks like}

---

## Healing Categories

| Category | Description | Example Issue |
|----------|-------------|---------------|
| {Category 1} | {Description} | {Example} |
| {Category 2} | {Description} | {Example} |
| Output Quality | General quality issues | "Result wasn't useful" |
| False Positives | Flagging non-issues | "Flagged valid content" |

---

## Review Checklist

Before approving output, verify:

- [ ] {Auto-generated check based on skill purpose}
- [ ] {Auto-generated check based on output type}
- [ ] {Auto-generated check based on quality markers}
- [ ] Meets user's stated requirements
- [ ] No critical errors or omissions

---

## Approval Criteria

### Auto-Approve When:
- Output matches expected format
- No critical issues detected
- User hasn't flagged concerns

### Request User Review When:
- First time using this skill
- Output differs from usual pattern
- Uncertainty about requirements

### Block and Ask When:
- Critical quality issue detected
- Missing required elements
- Conflicting requirements

---

## VALUE LESSONS

### {Category 1}

<!-- Lessons will be added here as feedback is received -->

### {Category 2}

<!-- Lessons will be added here as feedback is received -->

---

## Healing Log

| Date | Category | Issue | Fix Applied |
|------|----------|-------|-------------|
| {created} | System | Initial setup | Auto-generated healing file |

---

## Improvement Suggestions

Based on this skill's purpose, watch for:

1. **{Suggestion 1}** - {Why this matters}
2. **{Suggestion 2}** - {Why this matters}
3. **{Suggestion 3}** - {Why this matters}

---

<!--
This file was auto-generated by the self-healing framework.
Customize the categories and checks above to match your needs.
Use /heal-log or /{skill}-feedback to add VALUE LESSONS.
-->
```

---

## User Confirmation for Custom Items

After generating, ask user:

```
I've created a custom self-healing file for {skill-name}.

Based on my analysis, I've added these review items:

üìã REVIEW CHECKLIST
- [ ] {Item 1}
- [ ] {Item 2}
- [ ] {Item 3}

üè∑Ô∏è HEALING CATEGORIES
- {Category 1}: {Description}
- {Category 2}: {Description}

Would you like to:
[A] Use as-is - looks good
[B] Add more items - I have specific things to check
[C] Edit categories - I want different categories
```

If B: Ask what to add, then update the file
If C: Ask what categories, then update the file

---

## Integration with Skill Creation

### When /heal-create is used:
- Automatically includes self-healing (no prompt needed)
- Generates custom SELF_HEALING.md based on skill info
- Asks user to confirm/customize

### When skill is created manually (without /heal-create):
- Detect on first use or when skill files are saved
- Prompt: "This skill doesn't have self-healing. Add it?"
- If yes: Generate custom SELF_HEALING.md
- If no: Note in audit log, remind later

### When skill is imported from another source:
- Check for existing SELF_HEALING.md
- If missing: Prompt to add
- If present: Validate format, suggest improvements

---

## Skill Analysis Prompts

### For Content/Copy Skills:
```
Categories to suggest:
- AI Patterns (em dashes, cliches)
- Tone/Voice (formal vs casual)
- Structure (sections, flow)
- Missing Elements (CTA, headline)
- Length/Format (too long, wrong format)
```

### For Code/Technical Skills:
```
Categories to suggest:
- Syntax Errors
- Logic Issues
- Performance
- Security
- Best Practices
- Documentation
```

### For Analysis/Research Skills:
```
Categories to suggest:
- Accuracy
- Completeness
- Relevance
- Clarity
- Actionability
```

### For Automation/Workflow Skills:
```
Categories to suggest:
- Execution Errors
- Missing Steps
- Wrong Order
- Permission Issues
- Integration Problems
```

---

## System Prompt Addition

Add this to systemPromptAdditions to enable auto-detection:

```json
"self-healing-auto-detect": {
  "enabled": true,
  "description": "Automatically detect skills without self-healing and prompt to add",
  "content": "## Self-Healing Auto-Detection\n\nWhen ANY new skill is created or modified:\n\n1. Check if skill has SELF_HEALING.md\n2. Check if skill has /{skill}-feedback command\n3. If missing, prompt user to add self-healing\n4. If user agrees, auto-generate custom SELF_HEALING.md\n5. Customize based on skill's purpose and outputs\n\nThis ensures ALL skills continuously improve through feedback."
}
```

---

## Audit Trail Entry

When auto-healing is added:

```markdown
| Date | Time | Skill | Action | Category | Severity | Details |
|------|------|-------|--------|----------|----------|---------|
| {date} | {time} | {skill} | AUTO-HEAL | System | Important | Auto-generated SELF_HEALING.md with {N} categories |
```
